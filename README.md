# Pulumi for GitLab CE Infrastructure

This is a Pulumi program written in Python that automates the deployment of a self-hosted GitLab Community Edition (CE)
instance on DigitalOcean and configures Cloudflare Tunneling for enhanced performance and security.

## Prerequisites

Before deploying your GitLab CE instance, ensure that you have the following prerequisites in place:

1. **Pulumi**: Install Pulumi from [here](https://www.pulumi.com/docs/get-started/install/).

2. **DigitalOcean Account**: Pulumi requires an API token

3. **Cloudflare Account**: Pulumi requires an API token, the target AccountID and ZoneID.

4. **Python Environment**: Python is required for this project. Pulumi will generate a venv on first run.

## Configuration

- `app_name`: The name of your GitLab CE instance.

- `region`: The DigitalOcean region where your GitLab CE Droplet will be deployed.

- `image`: The Droplet image to use for GitLab CE. The default is "ubuntu-22-04-x64"
- `size`: The Droplet size slug.

- `tags`: Tags to associate with your GitLab CE Droplet.

- `dns_dict`: A dictionary mapping DNS names to ports for ingress rules.

## Running the Program

To deploy, follow these steps:

1. Clone this repository to your local machine.

2. Open a terminal and navigate to the directory containing the Pulumi program.

3. Initialize the Pulumi project by running:

   ```bash
   pulumi new

4. Configure DigitalOcean credentials by running:

    ```bash
    pulumi config set digitalocean:token --secret your-digitalocean-api-token

5. Configure Cloudflare secrets by running:

    ```bash
    pulumi config set cloudflare:accountId --secret your-cloudflare-account-id
    pulumi config set cloudflare:apiToken --secret your-cloudflare-secret
    pulumi config set cf:zoneId --secret your-cloudflare-zone-id 

6. Preview deployment:

    ```bash
    pulumi preview

7. Deploy stack:

    ```bash
    pulumi up --yes

8. Pulumi will deploy the DigitalOcean droplet, secure it with a firewall, and configure the CloudFlare Tunnel and
   ingress rules.

## Outputs

Upon successful deployment, the following outputs are available:

- `DigitalOcean Project`: The name of the DigitalOcean project.

- `VM public IP`: The public IP address of the GitLab CE Droplet.

- `Gitlab URLs`: URLs for accessing the GitLab CE instance.

### Disclaimer

```text
This README was generated by AI. 
```